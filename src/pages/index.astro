---
import Layout from "../layouts/Layout.astro";
import { getCollection } from "astro:content";
import { musicData, parseMusicEntry } from "../data/playlist";

// 1. ìµœì‹  ê¸€
const allPosts = await getCollection("blog");
const sortedPosts = allPosts.sort((a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf());
const latestPosts = sortedPosts.slice(0, 3);
const latestPost = sortedPosts[0];

// 2. ìŒì•…
const featuredMusic = [...musicData].sort(() => Math.random() - 0.5).slice(0, 2);

// 3. ì‡¼ì¸ 
const shortsUrl = "https://www.youtube.com/shorts/a_hES6wF71o";
const getShortsEmbed = (url) => {
  const id = url.split('shorts/')[1].split('?')[0];
  return `https://www.youtube.com/embed/${id}?autoplay=0&controls=1&modestbranding=1&loop=1&playlist=${id}&rel=0`;
};
const shortsEmbed = getShortsEmbed(shortsUrl);
---

<Layout title="Winter's Desk">
  <div class="min-h-screen relative flex flex-col items-center justify-center p-6 py-20">
    
    <div class="absolute top-[-10%] left-[-10%] w-[600px] h-[600px] bg-rose-200/40 rounded-full blur-[120px] animate-pulse pointer-events-none"></div>
    <div class="absolute bottom-[-10%] right-[-10%] w-[500px] h-[500px] bg-indigo-100/40 rounded-full blur-[100px] pointer-events-none"></div>

    <div class="relative z-10 w-full max-w-6xl flex flex-col gap-12">
      
      <div class="bg-white/60 backdrop-blur-xl border border-white/60 rounded-[3rem] shadow-[0_8px_30px_rgb(0,0,0,0.04)] p-10 md:p-12 text-center relative overflow-hidden group">
        <div class="absolute top-8 left-8 flex gap-2">
          <div class="w-3 h-3 rounded-full bg-rose-400"></div>
          <div class="w-3 h-3 rounded-full bg-yellow-400"></div>
          <div class="w-3 h-3 rounded-full bg-green-400"></div>
        </div>
        <span class="inline-block mt-2 mb-4 text-4xl animate-bounce">ğŸ€</span>
        <h1 class="text-5xl md:text-7xl font-black text-stone-800 tracking-tight mb-4">
          Zimza1abim<span class="text-rose-400">.log</span>
        </h1>
        <p class="text-stone-500 text-lg md:text-xl font-light leading-relaxed max-w-2xl mx-auto">
          'æœ‰å¿—ç«Ÿæˆ' <span class="text-stone-800 font-medium">ëœ»ì´ ìˆìœ¼ë©´, ë§ˆì¹¨ë‚´ ì´ë£¬ë‹¤</span><br/>
          <span class="text-rose-500 font-medium bg-rose-50 px-2 py-1 rounded-lg">Believe in your flyness, conquer your shyness.</span>
        </p>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-12 gap-6">
        
        <div class="md:col-span-4 flex flex-col h-full">
          <div class="h-full bg-white p-5 rounded-[3rem] border border-stone-100 shadow-xl shadow-rose-50 hover:shadow-2xl hover:shadow-rose-100 transition-all duration-500 group relative flex flex-col">
            
            <div class="flex justify-between items-center px-1 mb-4">
              <span class="text-[10px] font-bold text-rose-500 bg-rose-50 px-3 py-1 rounded-full border border-rose-100 tracking-widest">
                MOTIVATION VIBE âš¡ï¸
              </span>
              <div class="flex gap-1">
                <div class="w-1.5 h-1.5 rounded-full bg-stone-300"></div>
                <div class="w-1.5 h-1.5 rounded-full bg-stone-300"></div>
              </div>
            </div>

            <div class="relative w-full flex-grow rounded-[2rem] overflow-hidden bg-black border-2 border-stone-50 aspect-[9/16] shadow-inner">
               <iframe 
                  src={shortsEmbed}
                  class="w-full h-full absolute inset-0"
                  frameborder="0"
                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                  allowfullscreen
                ></iframe>
            </div>
            
            <div class="text-center mt-4">
              <p class="text-stone-400 text-xs font-light group-hover:text-rose-400 transition-colors tracking-wider">
                
              </p>
            </div>

          </div>
        </div>

        <div class="md:col-span-8 grid grid-cols-2 gap-6 content-start">
          <a href="/blog" class="col-span-2 bg-white rounded-[2.5rem] p-8 shadow-lg shadow-stone-100 border border-white hover:-translate-y-2 hover:shadow-xl hover:shadow-rose-100 transition-all duration-300 flex items-center justify-between group h-44">
            <div class="text-left">
              <span class="text-xs font-bold text-rose-400 uppercase tracking-widest bg-rose-50 px-3 py-1 rounded-full">New Post</span>
              <h3 class="text-2xl font-bold text-stone-800 mt-3 line-clamp-1 group-hover:text-rose-500 transition-colors">
                {latestPost ? latestPost.data.title : "ë¸”ë¡œê·¸ êµ¬ê²½í•˜ê¸°"}
              </h3>
            </div>
            <div class="text-6xl group-hover:scale-110 transition-transform duration-300">ğŸ“</div>
          </a>

          <a href="/music" class="bg-gradient-to-br from-rose-400 to-rose-500 rounded-[2.5rem] p-6 shadow-lg shadow-rose-200 text-white flex flex-col justify-between hover:-translate-y-2 transition-transform duration-300 relative overflow-hidden h-48">
            <div class="flex justify-between items-start z-10">
              <span class="text-white/80 text-xs font-bold uppercase">Music</span>
              <span class="animate-spin-slow text-2xl">ğŸ’¿</span>
            </div>
            <div class="z-10">
              <h3 class="font-bold text-xl leading-tight">My<br>Playlist</h3>
            </div>
            <div class="absolute -bottom-4 -right-4 w-28 h-28 bg-white/20 rounded-full blur-xl"></div>
          </a>

          <a href="https://github.com/zimza1abim" target="_blank" class="bg-stone-800 rounded-[2.5rem] p-6 shadow-lg text-white flex flex-col justify-center items-center text-center hover:-translate-y-2 transition-transform duration-300 group h-48">
            <div class="w-14 h-14 bg-white/10 rounded-full flex items-center justify-center mb-3 text-3xl group-hover:rotate-12 transition-transform">
              ğŸ‘¾
            </div>
            <h3 class="font-bold text-lg">Github</h3>
            <p class="text-stone-400 text-xs mt-1">Source Code</p>
          </a>

          <a href="/personal" class="bg-yellow-100/80 backdrop-blur-sm border border-yellow-200 rounded-[2.5rem] p-6 shadow-lg rotate-2 hover:rotate-0 transition-transform duration-300 flex flex-col justify-center items-center text-center h-40">
              <div class="text-4xl mb-2">âœï¸</div>
              <h3 class="font-bold text-stone-700 text-lg">Scribble</h3>
              <p class="text-stone-500 text-xs">ë‚™ì„œì¥</p>
          </a>

          <a href="/reserve" class="bg-white/40 backdrop-blur-md border border-white/60 rounded-[2.5rem] p-6 flex flex-col justify-center items-center hover:bg-white/60 transition-colors cursor-pointer h-40">
             <span class="text-stone-400 text-sm font-medium dashed-border">ğŸš§ Playground</span>
          </a>
        </div>
      </div>

      <div class="bg-white/80 backdrop-blur-xl border border-white rounded-[3rem] p-8 shadow-xl shadow-rose-50">
        <h2 class="text-xl font-bold text-stone-700 mb-6 flex items-center gap-2">
          <span class="bg-rose-100 text-rose-500 w-8 h-8 flex items-center justify-center rounded-full text-sm">ğŸµ</span>
          Today's Vibe
        </h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          {featuredMusic.map((entry) => {
            const item = parseMusicEntry(entry);
            return (
              <div class="bg-white p-4 rounded-[2rem] border border-stone-100 shadow-sm hover:shadow-md hover:-translate-y-1 transition-all flex gap-4 items-center overflow-hidden group">
                <div class={`w-20 h-20 shrink-0 rounded-[1.5rem] overflow-hidden bg-stone-100 ${item.isVideo ? 'aspect-video' : 'aspect-square'}`}>
                   {item.src && (
                     <iframe 
                        src={item.src} 
                        class="w-full h-full pointer-events-none" 
                        frameborder="0"
                        loading="lazy"
                      ></iframe>
                   )}
                </div>
                <div class="flex flex-col justify-center flex-1 pr-2">
                  <h3 class="text-base font-bold text-stone-700 leading-tight line-clamp-1 mb-1 group-hover:text-rose-500 transition-colors">{item.title}</h3>
                  <a href="/music" class="text-xs text-stone-400 hover:text-rose-500 transition-colors flex items-center gap-1">Listen More â†’</a>
                </div>
                <div class="text-xl opacity-20 group-hover:opacity-100 group-hover:rotate-12 transition-all duration-300 pr-2">ğŸ§</div>
              </div>
            )
          })}
        </div>
      </div>

      <div class="mb-20">
        <div class="flex items-center justify-between mb-8 px-4">
          <h2 class="text-2xl font-bold text-stone-800">Latest Stories</h2>
          <a href="/blog" class="text-sm text-rose-500 font-medium hover:text-rose-600 border-b border-rose-200 hover:border-rose-500 transition-all">View all</a>
        </div>
        <div class="grid gap-8 sm:grid-cols-2 lg:grid-cols-3">
          {latestPosts.map((post) => (
            <a href={`/blog/${post.slug}`} class="group block">
              <div class="relative overflow-hidden rounded-[2rem] mb-4 aspect-[4/3] bg-white border-4 border-white shadow-sm group-hover:shadow-md transition-all">
                 <img 
                    src={post.data.image?.src || "https://images.unsplash.com/photo-1555066931-4365d14bab8c?q=80&w=1000&auto=format&fit=crop"} 
                    alt={post.data.title} 
                    class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105"
                  />
              </div>
              <h3 class="font-bold text-stone-800 text-lg leading-snug group-hover:text-rose-500 transition-colors px-2">{post.data.title}</h3>
              <p class="text-xs text-stone-400 mt-2 px-2 uppercase tracking-wider">{post.data.publishDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}</p>
            </a>
          ))}
        </div>
      </div>

    </div>

    <div class="mt-12 bg-white/80 backdrop-blur-xl border border-white/50 px-6 py-4 rounded-full shadow-2xl shadow-stone-200/50 flex items-center gap-6 animate-fade-in-up sticky bottom-8 z-50">
       <a href="/about" class="w-12 h-12 flex items-center justify-center rounded-2xl hover:bg-rose-100 text-2xl transition-colors" title="About">ğŸ‘©ğŸ»â€ğŸ’»</a>
       <div class="w-px h-8 bg-stone-200"></div> 
       <a href="/blog" class="w-12 h-12 flex items-center justify-center rounded-2xl hover:bg-rose-100 text-2xl transition-colors" title="Blog">ğŸ“š</a>
       <a href="/music" class="w-12 h-12 flex items-center justify-center rounded-2xl hover:bg-rose-100 text-2xl transition-colors" title="Music">ğŸ§</a>
       <div class="w-px h-8 bg-stone-200"></div> 
       <a href="mailto:your@email.com" class="w-12 h-12 flex items-center justify-center rounded-2xl hover:bg-rose-100 text-2xl transition-colors" title="Contact">ğŸ’Œ</a>
    </div>

  </div>
</Layout>

<style>
  @keyframes spin-slow {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }
  .animate-spin-slow {
    animation: spin-slow 8s linear infinite;
  }
</style>