---
import Layout from "../layouts/Layout.astro";
import { getCollection } from "astro:content";
// â–¼â–¼â–¼ ê³µìš© ë°ì´í„° ê°€ì ¸ì˜¤ê¸° â–¼â–¼â–¼
import { musicData, parseMusicEntry } from "../data/playlist";

// 1. ìµœì‹  ê¸€ ê°€ì ¸ì˜¤ê¸° & ì •ë ¬
const allPosts = await getCollection("blog");
const sortedPosts = allPosts.sort((a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf());
const latestPosts = sortedPosts.slice(0, 3); // ëª©ë¡ìš© 3ê°œ
const latestPost = sortedPosts[0]; // ìœ„ì ¯ìš© ìµœì‹ ê¸€ 1ê°œ

// 2. ë©”ì¸ìš© ìŒì•… 2ê°œ ëœë¤ ì¶”ì¶œ
const featuredMusic = [...musicData].sort(() => Math.random() - 0.5).slice(0, 2);
---

<Layout title="Winter's Desk">
  <div class="min-h-screen relative overflow-x-hidden bg-[#fffdfc] flex flex-col items-center justify-center p-6 py-20">
    
    <div class="absolute top-[-10%] left-[-10%] w-[600px] h-[600px] bg-rose-200/40 rounded-full blur-[120px] animate-pulse pointer-events-none"></div>
    <div class="absolute bottom-[-10%] right-[-10%] w-[500px] h-[500px] bg-indigo-100/40 rounded-full blur-[100px] pointer-events-none"></div>

    <div class="relative z-10 w-full max-w-5xl flex flex-col gap-16">
      
      <div class="bg-white/60 backdrop-blur-xl border border-white/60 rounded-[3rem] shadow-[0_8px_30px_rgb(0,0,0,0.04)] p-10 md:p-14 text-center relative overflow-hidden group">
        <div class="absolute top-8 left-8 flex gap-2">
          <div class="w-3 h-3 rounded-full bg-rose-400"></div>
          <div class="w-3 h-3 rounded-full bg-yellow-400"></div>
          <div class="w-3 h-3 rounded-full bg-green-400"></div>
        </div>

        <span class="inline-block mt-2 mb-4 text-4xl animate-bounce">ğŸ€</span>
        
        <h1 class="text-5xl md:text-7xl font-black text-stone-800 tracking-tight mb-4">
          Zimza1abim<span class="text-rose-400">.log</span>
        </h1>
        
        <p class="text-stone-500 text-lg md:text-xl font-light leading-relaxed max-w-2xl mx-auto">
          ë³´ì•ˆê³¼ ì½”ë”©ì„ ì¢‹ì•„í•˜ëŠ” <span class="text-stone-800 font-medium">ë³´ì•ˆ ì—”ì§€ë‹ˆì–´</span>ì˜<br/>
          <span class="text-rose-500 font-medium bg-rose-50 px-2 py-1 rounded-lg">ì‘ê³  ì†Œì¤‘í•œ</span> ê¸°ë¡ ê³µê°„ì…ë‹ˆë‹¤.
        </p>
      </div>

      <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
        <a href="/blog" class="col-span-2 bg-white rounded-[2.5rem] p-8 shadow-lg shadow-stone-100 border border-white hover:-translate-y-2 hover:shadow-xl hover:shadow-rose-100 transition-all duration-300 flex items-center justify-between group">
          <div class="text-left">
            <span class="text-xs font-bold text-rose-400 uppercase tracking-widest bg-rose-50 px-3 py-1 rounded-full">New Post</span>
            <h3 class="text-xl md:text-2xl font-bold text-stone-800 mt-3 line-clamp-1 group-hover:text-rose-500 transition-colors">
              {latestPost ? latestPost.data.title : "ë¸”ë¡œê·¸ êµ¬ê²½í•˜ê¸°"}
            </h3>
            <p class="text-stone-400 text-sm mt-1">ìƒˆë¡œìš´ ê¸€ ì½ìœ¼ëŸ¬ ê°€ê¸° â†’</p>
          </div>
          <div class="text-5xl group-hover:scale-110 transition-transform duration-300">ğŸ“</div>
        </a>

        <a href="/music" class="bg-gradient-to-br from-rose-400 to-rose-500 rounded-[2.5rem] p-6 shadow-lg shadow-rose-200 text-white flex flex-col justify-between hover:-translate-y-2 transition-transform duration-300 relative overflow-hidden">
          <div class="flex justify-between items-start z-10">
            <span class="text-white/80 text-xs font-bold uppercase">Music</span>
            <span class="animate-spin-slow text-xl">ğŸ’¿</span>
          </div>
          <div class="z-10">
            <h3 class="font-bold text-lg leading-tight">My<br>Playlist</h3>
          </div>
          <div class="absolute -bottom-4 -right-4 w-24 h-24 bg-white/20 rounded-full blur-xl"></div>
        </a>

        <a href="https://github.com/zimza1abim" target="_blank" class="bg-stone-800 rounded-[2.5rem] p-6 shadow-lg text-white flex flex-col justify-center items-center text-center hover:-translate-y-2 transition-transform duration-300 group">
          <div class="w-12 h-12 bg-white/10 rounded-full flex items-center justify-center mb-3 text-2xl group-hover:rotate-12 transition-transform">
            ğŸ‘¾
          </div>
          <h3 class="font-bold">Github</h3>
          <p class="text-stone-400 text-xs mt-1">Source Code</p>
        </a>

        <a href="/personal" class="bg-yellow-100/80 backdrop-blur-sm border border-yellow-200 rounded-[2.5rem] p-6 shadow-lg rotate-2 hover:rotate-0 transition-transform duration-300 flex flex-col justify-center items-center text-center">
            <div class="text-3xl mb-2">âœï¸</div>
            <h3 class="font-bold text-stone-700">Scribble</h3>
            <p class="text-stone-500 text-xs">ë‚™ì„œì¥</p>
        </a>

        <a href="/reserve" class="col-span-2 md:col-span-1 bg-white/40 backdrop-blur-md border border-white/60 rounded-[2.5rem] p-6 flex flex-col justify-center items-center hover:bg-white/60 transition-colors cursor-pointer">
           <span class="text-stone-400 text-sm font-medium dashed-border">ğŸš§ Playground</span>
        </a>
      </div>

      <div>
        <div class="flex items-center gap-3 mb-8 px-4">
          <div class="w-2 h-8 bg-rose-400 rounded-full"></div>
          <h2 class="text-3xl font-bold text-stone-800 tracking-tight">Today's <span class="text-rose-400 italic font-serif">Vibe</span></h2>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
          {featuredMusic.map((entry, index) => {
            const item = parseMusicEntry(entry);
            return (
              <div class="group relative flex flex-col items-center">
                
                <div class="absolute inset-0 bg-gradient-to-tr from-rose-200 to-indigo-200 rounded-[3rem] blur-2xl opacity-0 group-hover:opacity-50 transition-opacity duration-700 scale-95 -z-10"></div>

                <div class="relative w-full bg-white/70 backdrop-blur-xl p-3 rounded-[3rem] border border-white shadow-[0_8px_30px_rgb(0,0,0,0.04)] transition-transform duration-500 group-hover:-translate-y-2">
                  
                  <div class={`relative w-full overflow-hidden rounded-[2.5rem] bg-stone-100 ${item.isVideo ? 'aspect-video' : 'aspect-square'}`}>
                    {item.src ? (
                      <iframe 
                        src={item.src} 
                        class="w-full h-full"
                        frameborder="0" 
                        allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" 
                        loading="lazy"
                      ></iframe>
                    ) : (
                      <div class="flex flex-col items-center justify-center h-full text-rose-300">
                        <span>Link Error ğŸ’”</span>
                      </div>
                    )}
                    
                    <div class="absolute inset-0 opacity-[0.03] pointer-events-none bg-[url('https://grainy-gradients.vercel.app/noise.svg')]"></div>
                    <div class="absolute inset-0 bg-gradient-to-tr from-white/0 via-white/10 to-white/40 opacity-0 group-hover:opacity-100 transition-opacity duration-500 pointer-events-none"></div>
                  </div>

                  <div class="px-5 pt-5 pb-3">
                    <div class="flex justify-between items-end mb-3">
                      <div class="flex flex-col overflow-hidden pr-2">
                        <span class="text-[10px] font-bold text-rose-400 uppercase tracking-wider mb-1">Recommand 0{index + 1}</span>
                        <h3 class="text-lg font-bold text-stone-700 truncate w-full group-hover:text-rose-500 transition-colors">
                          {item.title}
                        </h3>
                      </div>
                      <a href="/music" class="w-10 h-10 rounded-full bg-stone-50 flex items-center justify-center text-stone-400 group-hover:bg-rose-500 group-hover:text-white transition-all duration-300 shadow-sm shrink-0">
                        <span class="text-lg">â†’</span>
                      </a>
                    </div>
                    
                    <div class="w-full h-1.5 bg-stone-200 rounded-full overflow-hidden">
                      <div class="h-full w-0 bg-gradient-to-r from-rose-300 to-rose-500 rounded-full group-hover:w-full transition-all duration-[2s] ease-out"></div>
                    </div>
                  </div>

                </div>
              </div>
            )
          })}
        </div>
      </div>

      <div class="mb-20">
        <div class="flex items-center justify-between mb-8 px-4">
          <h2 class="text-2xl font-bold text-stone-800">Latest Stories</h2>
          <a href="/blog" class="text-sm text-rose-500 font-medium hover:text-rose-600 border-b border-rose-200 hover:border-rose-500 transition-all">View all</a>
        </div>

        <div class="grid gap-8 sm:grid-cols-2 lg:grid-cols-3">
          {latestPosts.map((post) => (
            <a href={`/blog/${post.slug}`} class="group block">
              <div class="relative overflow-hidden rounded-[2rem] mb-4 aspect-[4/3] bg-white border-4 border-white shadow-sm group-hover:shadow-md transition-all">
                 {post.data.image?.src ? (
                    <img 
                      src={post.data.image.src} 
                      alt={post.data.title} 
                      class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105"
                    />
                  ) : (
                    <div class="w-full h-full bg-stone-50 flex items-center justify-center">
                      <span class="text-2xl opacity-30">â˜ï¸</span>
                    </div>
                  )}
              </div>
              <h3 class="font-bold text-stone-800 text-lg leading-snug group-hover:text-rose-500 transition-colors px-2">
                {post.data.title}
              </h3>
              <p class="text-xs text-stone-400 mt-2 px-2 uppercase tracking-wider">
                {post.data.publishDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}
              </p>
            </a>
          ))}
        </div>
      </div>

    </div>

    <div class="mt-12 bg-white/80 backdrop-blur-xl border border-white/50 px-6 py-4 rounded-full shadow-2xl shadow-stone-200/50 flex items-center gap-6 animate-fade-in-up sticky bottom-8 z-50">
       <a href="/about" class="w-12 h-12 flex items-center justify-center rounded-2xl hover:bg-rose-100 text-2xl transition-colors" title="About">ğŸ‘©ğŸ»â€ğŸ’»</a>
       <div class="w-px h-8 bg-stone-200"></div> 
       <a href="/blog" class="w-12 h-12 flex items-center justify-center rounded-2xl hover:bg-rose-100 text-2xl transition-colors" title="Blog">ğŸ“š</a>
       <a href="/music" class="w-12 h-12 flex items-center justify-center rounded-2xl hover:bg-rose-100 text-2xl transition-colors" title="Music">ğŸ§</a>
       <div class="w-px h-8 bg-stone-200"></div> 
       <a href="mailto:your@email.com" class="w-12 h-12 flex items-center justify-center rounded-2xl hover:bg-rose-100 text-2xl transition-colors" title="Contact">ğŸ’Œ</a>
    </div>

  </div>
</Layout>

<style>
  @keyframes spin-slow {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }
  .animate-spin-slow {
    animation: spin-slow 8s linear infinite;
  }
</style>