---
import Layout from "../layouts/Layout.astro";
import Container from "../components/container.astro";
// ▼▼▼ [핵심] 데이터와 로직을 한 번에 가져옵니다 ▼▼▼
import { musicData, parseMusicEntry } from "../data/playlist";

// 셔플만 여기서 수행
const shuffledLinks = [...musicData].sort(() => Math.random() - 0.5);
---

<Layout title="Music Collection">
  <div class="min-h-screen bg-gradient-to-b from-rose-50/30 to-white">
    <Container>
      
      <div class="text-center pt-24 mb-20">
        <span class="text-rose-400 font-bold tracking-[0.2em] text-xs uppercase mb-3 block">
          Winter's Playlist
        </span>
        <h1 class="text-4xl lg:text-6xl font-bold text-stone-800 tracking-tight mb-4">
          Music <span class="text-rose-400 italic font-serif">Collection</span>
        </h1>
        <p class="text-stone-400 font-light text-sm">
          오늘의 기분을 채워줄 플레이리스트
        </p>
      </div>

      <div class="max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-x-10 gap-y-16 pb-40 px-4">
        {shuffledLinks.map((entry, index) => {
          // ▼▼▼ 공용 함수 사용 ▼▼▼
          const item = parseMusicEntry(entry);
          
          return (
            <div class="group flex flex-col">
              <div class="relative bg-white p-3 rounded-[2.5rem] shadow-[0_10px_30px_-10px_rgba(251,113,133,0.15)] border border-stone-100 transition-all duration-500 hover:-translate-y-2 hover:shadow-[0_20px_40px_-10px_rgba(251,113,133,0.25)]">
                <div class={`relative w-full overflow-hidden rounded-[2rem] bg-stone-50 ${item.isVideo ? 'aspect-video' : 'aspect-square'}`}>
                  {item.src ? (
                    <iframe 
                      src={item.src} 
                      class="w-full h-full"
                      frameborder="0" 
                      allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" 
                      loading="lazy"
                    ></iframe>
                  ) : (
                    <div class="flex flex-col items-center justify-center h-full text-rose-300">
                      <span>링크 오류</span>
                    </div>
                  )}
                  <div class="absolute inset-0 bg-gradient-to-tr from-white/0 via-white/0 to-white/30 opacity-0 group-hover:opacity-100 transition-opacity duration-500 pointer-events-none"></div>
                </div>
              </div>
              <div class="text-center mt-5 px-2">
                <h3 class="text-lg font-medium text-stone-700 group-hover:text-rose-500 transition-colors duration-300 line-clamp-1">
                  {item.title}
                </h3>
                <div class="w-8 h-0.5 bg-rose-200 mx-auto mt-3 rounded-full group-hover:w-16 transition-all duration-500"></div>
              </div>
            </div>
          )
        })}
      </div>

    </Container>
  </div>
</Layout>